# Nostr BIP-85 Key Ownership Proof Tools

This directory contains tools for proving ownership of Nostr keys derived using BIP-85 without revealing the master private key or creating public links between identities.

## Overview

These tools implement the ownership proof concepts described in [proof-of-ownership.md](proof-of-ownership.md), which serves as the specification document. The spec outlines a scenario where an anonymous inventor needs to prove ownership of a derived key (to claim a Nobel Prize) without revealing their master identity.

The repository includes three complementary proof tools:

1. **simple_proof.py**: Straightforward tool that proves multiple keys are derived from the same master
2. **nostr-ownership-proof.py**: Simple proof tool using dual signatures
3. **nostr-zk-proof.py**: Advanced tool implementing a simplified zero-knowledge proof system

## Installation

### Prerequisites

- Python 3.7+ (tested with Python 3.13)
- All dependencies from the main nostr-derive.py tool
- Additional libraries for cryptographic operations

```bash
# Install required packages
pip install bip-utils secp256k1 cryptography
```

## Basic Ownership Proof Tool (nostr-ownership-proof.py)

This tool uses a straightforward dual-signature approach to prove ownership.

### Generating a Proof

```bash
# Make the script executable if needed
chmod +x nostr-ownership-proof.py

# Generate a proof
./nostr-ownership-proof.py generate \
  --master-nsec nsec1your_master_key \
  --derived-npub npub1derived_key \
  --index 1 \
  --output proof.json
```

### Verifying a Proof

```bash
./nostr-ownership-proof.py verify \
  --proof-file proof.json
```

## Zero-Knowledge Proof Tool (nostr-zk-proof.py)

This tool implements a more sophisticated challenge-response verification protocol with zero-knowledge properties.

### Setup (done once)

```bash
# Make the script executable if needed
chmod +x nostr-zk-proof.py

# Generate setup parameters
./nostr-zk-proof.py setup \
  --output-dir ~/.nostr-zk
```

### Generating a Proof

```bash
./nostr-zk-proof.py prove \
  --master-nsec nsec1your_master_key \
  --derived-npub npub1derived_key \
  --index 1 \
  --setup-dir ~/.nostr-zk \
  --output zk-proof.json
```

### Verifying a Proof

```bash
./nostr-zk-proof.py verify \
  --proof-file zk-proof.json \
  --setup-dir ~/.nostr-zk
```

## Usage with nostr-derive.py

These proof tools are designed to work seamlessly with keys generated by the nostr-derive.py script:

```bash
# Example workflow

# 1. Create a master key
./nostr-derive.py init
# Securely save the master nsec key

# 2. Create multiple derived identities
./nostr-derive.py create --label "Work Identity" --index 42
./nostr-derive.py create --label "Social Media" --index 43
./nostr-derive.py create --label "Gaming" --index 44
# Note the npubs of the derived identities

# 3a. Generate a simple proof linking multiple derived identities
./simple_proof.py --master-nsec nsec1your_master_key \
  --indices 42,43,44 \
  --output relationships.json

# OR

# 3b. Generate a ZK proof for a single derived identity
./nostr-zk-proof.py prove \
  --master-nsec nsec1your_master_key \
  --derived-npub npub1derived_key \
  --index 42 \
  --output proof.json

# 4. Share the proof with a third party (without revealing your master key)

# 5. Third party verifies the ZK proof
./nostr-zk-proof.py verify --proof-file proof.json
```

## Security Considerations

### Simple Proof Tool (simple_proof.py)

- Provides transparent evidence that multiple keys share the same master key
- Shows all derived keys and their relationship to the master key
- Includes both public and private keys of derived identities
- Best used with trusted parties or when full disclosure of relationships is acceptable

### Basic Proof Tool (nostr-ownership-proof.py)

- Proves control of both master and derived keys
- The proof itself doesn't hide the relationship between keys
- Simple verification through digital signatures

### ZK Proof Tool (nostr-zk-proof.py)

- Uses multiple challenge-response rounds for stronger verification
- Implements commitment schemes to conceal the master key
- Only links a single derived key to the master key in each proof
- More complex but provides stronger privacy guarantees

## Technical Details

### How the Tools Work

#### Simple Proof Tool (simple_proof.py)

This tool provides a straightforward way to prove that multiple keys are derived from the same master key:

1. It takes a master private key and a list of indices as input
2. For each index, it:
   - Derives a child key using BIP-85
   - Computes the corresponding public key
   - Formats both in bech32 format (nsec/npub)
3. It outputs a JSON file containing:
   - The master public key (npub)
   - A list of all derived keys with their indices, public keys, private keys, and key hashes
   - The verification method ("bip85-derivation")

The proof directly shows which keys are derived from the same master without any complex cryptographic operations.

#### Basic Proof Tool (nostr-ownership-proof.py)

This tool uses a dual-signature approach:

1. It takes a master private key, a derived public key, and an index
2. It derives the child key and verifies it matches the provided public key
3. It creates a message stating the relationship between the keys
4. It signs this message with both the master key and the derived key
5. The proof contains both signatures, which can be verified independently

#### ZK Proof Tool (nostr-zk-proof.py)

This tool implements a challenge-response protocol with zero-knowledge properties:

1. **Setup Phase**: Generates random salts used for the commitment scheme
2. **Challenge Generation**: Creates randomized challenges based on the keys and index
3. **Proof Creation**:
   - Uses the derived key to sign the challenges
   - Uses the master key to create commitments and sign derived signatures
   - No direct exposure of the master key
4. **Verification**:
   - Verifies the derived key's signatures on challenges
   - Verifies the master key's signatures on the derived signatures
   - Confirms a threshold of valid responses

### Security Limitations

These tools provide a practical demonstration of ownership proof concepts, but have some limitations:

1. The simple_proof.py tool exposes all keys and does not provide privacy
2. The ZK tool uses a simplified approach compared to formal ZK-SNARKs or ZK-STARKs
3. They may not be suitable for high-security applications without further review

### Future Improvements

Potential improvements to consider:

1. Implementation of formal ZK-SNARKs using libraries like `pysnark` or `zokrates`
2. Support for proving ownership of multiple derived keys simultaneously with better privacy
3. Web-based interface for easier verification
4. Integration with Nostr clients and relays

## Specification

These tools implement the concepts outlined in the [proof-of-ownership.md](proof-of-ownership.md) specification, which describes:

1. The "Nobel Prize Verification Scenario" - a use case for anonymous invention ownership
2. The theoretical foundation for zero-knowledge proofs in this context
3. A formal specification for a Nostr ZK-SNARK Ownership Proof system

While the current implementation uses a simplified approach compared to formal ZK-SNARKs, it follows the core principles outlined in the specification and provides a practical demonstration of the ownership proof concept.

## Limitations

- These are not fully formal zero-knowledge proofs in the cryptographic sense
- The ZK tool uses a simplified approach compared to true ZK-SNARKs or ZK-STARKs
- For high-security applications, a more formal implementation might be necessary

## Contributing

Contributions are welcome, especially in the following areas:
- Implementation of formal ZK-SNARKs using libraries like `pysnark` or `zokrates`
- Support for proving ownership of multiple derived keys simultaneously
- Web-based verification interface
- Integration with Nostr clients and relays